<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru">
<head>
<title>[== $lang->{auth_title} =]</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta http-equiv="cache-control" content="max-age=0">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">
<meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT">
<meta http-equiv="pragma" content="no-cache">
<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/css/login.css">
<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/jquery.corner.js" type="text/javascript"></script>
<script src="/js/bootstrap.min.js" type="text/javascript"></script>
<script src="/js/admin.helper.js" type="text/javascript"></script>
</head>
<body>

<div id="taracot_auth">
 <form class="form-vertical" id="auth_form">
  <label>[== $lang->{auth_username} =]</label>
  <input type="text" placeholder="" id="auth_username" class="span4">
  <label>[== $lang->{auth_password} =]</label>
  <input type="password"  id="auth_password" class="span4">
  <a class="btn" id="btn_login">[== $lang->{auth_login} =]</a>
 </form>
 <img src="/images/grey_loading.gif" width="32" height="32" alt="" id="taracot_auth_img" style="display:none" />
</div>

<div class="modal" style="display:none" id="auth_error_modal">
 <div class="modal-header">
  <a class="close" data-dismiss="modal">Ã—</a>
  <h3>[== $lang->{auth_error_title} =]</h3>
 </div>
 <div class="modal-body">
  <p>[== $lang->{auth_error_text} =]</p>
 </div>
  <div class="modal-footer">
     <a class="btn" id="auth_error_close">[== $lang->{auth_close} =]</a>
 </div>
</div>

<script type="text/javascript">
$('#btn_login').click( function() {
   $('#auth_form').hide();
   $('#taracot_auth_img').show();
   $.ajax({
    type: 'POST',
    url: '/admin/authorize',
    data: { username: $('#auth_username').val(), password: $('#auth_password').val() },
    dataType: "json",
    success: function(data) {
      if (data.result == '1') {
        location.href='/admin?'+randomString(12);
       } else {
        $('#auth_form').show();
        $('#taracot_auth_img').hide();
        $('#auth_password').val('');
        $('#auth_username').focus();
        $('#auth_error_modal').modal({keyboard: true});
       } 
    },
    error: function() {
       $('#auth_form').show();
       $('#taracot_auth_img').hide();
       $('#auth_password').val('');
       $('#auth_username').focus();
       alert("[== $lang->{error_ajax} =]");
    }
   });
});
$('#auth_error_close').click( function() {
   $('#auth_error_modal').modal('hide'); 
});
</script> 
<script type="text/javascript">
$(document).ready(
 function(){
   $('#taracot_auth').corner('6px');
   $('#auth_username').focus();
   $("#auth_password").keypress(function(e){
    if(e.which==13) { $("#btn_login").click(); }
   });
   $("#auth_username").keypress(function(e){
    if(e.which==13) {$('#auth_error_modal').modal('hide'); }
   });
  });
</script> 
</body>  
</html>