<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />
  <title>[== $lang->{auth_title} =]</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta http-equiv="cache-control" content="max-age=0">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT">
  <meta http-equiv="pragma" content="no-cache">
  <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="/css/login.css">
  <script src="/js/jquery.min.js" type="text/javascript"></script>
  <script src="/js/bootstrap.min.js" type="text/javascript"></script>
</head>
<body>

<div id="taracot_auth" style="display:none">
  <div id="taracot_error" style="display:none"><div id="taracot_error_msg">[== $lang->{auth_error_title} =]</div></div>
  <a href="/"><img src="/taracot/icon_transp_64.png" width="64" height="64" alt="Taracot CMS" id="taracot_logo" /></a>
  <form class="form-vertical" id="auth_form">
    <label>[== $lang->{auth_username} =]</label>
    <input type="text" placeholder="" id="auth_username">
    <label>[== $lang->{auth_password} =]</label>
    <input type="password"  id="auth_password">
    <div id="taracot_auth_buttons"><a class="btn btn-primary" id="btn_login">[== $lang->{auth_login} =]</a>&nbsp;<a class="btn" id="btn_back">[== $lang->{auth_back} =]</a></div>
    <div id="taracot_about"><a href="http://taracot.org">Taracot CMS</a> &copy; 2003-2012 Michael A. Matveev</div>
  </form>
  <img src="/images/grey_loading.gif" width="32" height="32" alt="" id="taracot_auth_img" style="display:none" />
</div>

<div id="taracot_old_browser_warning" style="display:none">
  <strong>[== $lang->{warning_browser_title} =]</strong><br/><br/>[== $lang->{warning_browser_text} =]<br/><br/>
  <a href="https://www.google.com/chrome/" target="_blank" class="browser_choice"><img src="/images/browser-chrome-logo.png" width="72" height="72" alt="Google Chrome" /></a>&nbsp;<a href="http://firefox.com/" target="_blank" class="browser_choice"><img src="/images/browser-firefox-logo.png" width="72" height="72" alt="Mozilla Firefox" /></a>&nbsp;<a href="http://www.opera.com/" target="_blank" class="browser_choice"><img src="/images/browser-opera-logo.png" width="72" height="72" alt="Opera" /></a>&nbsp;<a href="http://www.apple.com/safari/" target="_blank" class="browser_choice"><img src="/images/browser-safari-logo.png" width="72" height="72" alt="Safari" /></a>
  <div id="continue_anyway"><span class="btn btn-danger" id="btn_continue_anyway">[== $lang->{continue_anyway} =]</span>&nbsp;&nbsp;</div>
</div>

<script type="text/javascript">
var browser='';
var browserVersion=0;
$('#btn_login').click( function() {
   if (!$('#auth_username').val() || !$('#auth_password').val()) {
    $('#auth_username').focus();
    $('#taracot_logo').fadeOut(50).delay(2700).fadeIn(500);
    $('#taracot_error').fadeIn(400).delay(2000).fadeOut(400);
    return;
   }
   $('#auth_form').hide();
   $('#taracot_auth_img').show();
   $.ajax({
    type: 'POST',
    url: '/admin/authorize',
    data: { username: $('#auth_username').val(), password: $('#auth_password').val() },
    dataType: "json",
    success: function(data) {
      if (data.result == '1') {
        location.href='/admin?'+Math.random();
       } else {
        $('#auth_form').show();
        $('#taracot_auth_img').hide();
        $('#auth_password').val('');
        $('#auth_username').focus();
        $('#taracot_logo').fadeOut(50).delay(2700).fadeIn(500);
        $('#taracot_error').fadeIn(400).delay(2000).fadeOut(400);
       } 
    },
    error: function() {
       $('#auth_form').show();
       $('#taracot_auth_img').hide();
       $('#auth_password').val('');
       $('#auth_username').focus();
       alert("[== $lang->{error_ajax} =]");
    }
   });
});
$('#auth_error_close').click( function() {
   $('#auth_error_modal').modal('hide'); 
});
$('#btn_back').click( function() {
  location.href="/";
});
function detectBrowser(){
  browser = '';
  browserVersion = 0;
  if(/Opera[\/\s](\d+\.\d+)/.test(navigator.userAgent)){
    this.browser = 'Opera';
  } else if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){
    this.browser = 'MSIE';
  } else if(/Navigator[\/\s](\d+\.\d+)/.test(navigator.userAgent)){
    this.browser = 'Netscape';
  } else if(/Chrome[\/\s](\d+\.\d+)/.test(navigator.userAgent)){
    this.browser = 'Chrome';
  } else if(/Safari[\/\s](\d+\.\d+)/.test(navigator.userAgent)){
    this.browser = 'Safari';
    /Version[\/\s](\d+\.\d+)/.test(navigator.userAgent);
    this.browserVersion = new Number(RegExp.$1);
  } else if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){
    this.browser = 'Firefox';
  }
  if(this.browser == ''){
    this.browser = 'Unknown';
  } else if(this.browserVersion == 0) {
    this.browserVersion = parseFloat(new Number(RegExp.$1));
  }   
}
$('#btn_continue_anyway').click(function() {
  $('.browser_choice').hide(); 
  $('#btn_continue_anyway').hide();
  $('#taracot_old_browser_warning').fadeOut(1000); 
  $('#taracot_auth').fadeIn(1000);  
  $('#auth_username').focus();
})
$(document).ready(
 function(){
   $("#auth_password").keypress(function(e){
    if(e.which==13) { $("#btn_login").click(); }
   });
   $("#auth_username").keypress(function(e){
    if(e.which==13) {$('#auth_error_modal').modal('hide'); }
   });
   detectBrowser();
   if (browser && browser == "MSIE" && browserVersion && browserVersion < 9) {
    $('#taracot_old_browser_warning').show();
   } else {
    $('#taracot_auth').show();
    $('#auth_username').focus();
   }
  });
</script> 
</body>  
</html>